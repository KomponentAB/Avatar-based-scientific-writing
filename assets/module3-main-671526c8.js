import{g as k,q as h,c as v,p as w,l as x,m as b}from"./quests-779fea6d.js";import{b as M,g as Q}from"./init-ce66c3a4.js";WA.onInit().then(async()=>{try{await M(),console.log("Scripting API Extra ready")}catch(e){console.error(e)}const d=await k();for(const e of d){let t;WA.room.area.onEnter(e.name).subscribe(()=>{t=WA.ui.displayActionMessage({message:`[LEERTASTE] drücken um mit ${e.npcName} zu sprechen.`,callback:()=>{var a;if(WA.chat.sendChatMessage(e.chatText,e.npcName),e.triggerQuest){const s=WA.player.state.currentQuest,n=(a=h.find(i=>i.questId===e.triggerQuest))==null?void 0:a.requireQuest;s===n&&(WA.player.state.currentQuest=e.triggerQuest)}}})}),WA.room.area.onLeave(e.name).subscribe(()=>{t&&(t.remove(),WA.chat.close())})}WA.player.onPlayerMove(async({x:e,y:t,moving:a})=>{var n,i,r;const s=await v({x:e,y:t});if(!s){(n=b)==null||n.stop();return}if(!a&&!s){(i=b)==null||i.stop();return}else(r=b)==null||r.stop(),w(s)});const u=WA.player.state.currentQuest,l=h.find(e=>e.questId===u);l&&c(l.questId),WA.player.state.onVariableChange("currentQuest").subscribe(e=>{const t=h.find(a=>a.questId===e);t&&c(t.questId)});function c(e){const t=h.find(a=>a.questId===e);t&&WA.ui.banner.openBanner({id:t.questId,text:t.questDescription,bgColor:"#1B1B29",textColor:"#FFFFFF",closable:!1})}});async function q(){var d,u,l,c,e,t,a;try{const s=await Q(),n=[];for(const i of s.values())if(i.type==="objectgroup"){for(const r of i.objects)if(r.properties&&r.properties.some(m=>m.name==="isWorkbook"&&m.value===!0)){const m=(d=r.properties.find(o=>o.name==="XP"))==null?void 0:d.value,f=(u=r.properties.find(o=>o.name==="completionMessage"))==null?void 0:u.value,p=(l=r.properties.find(o=>o.name==="h5pPath"))==null?void 0:l.value,g=(c=r.properties.find(o=>o.name==="messageNpc"))==null?void 0:c.value,A=(e=r.properties.find(o=>o.name==="moduleMax"))==null?void 0:e.value,y=(t=r.properties.find(o=>o.name==="moduleName"))==null?void 0:t.value,W=(a=r.properties.find(o=>o.name==="workbookName"))==null?void 0:a.value;p&&y&&n.push({name:r.name,x:r.x,y:r.y,width:r.width??0,height:r.height??0,XP:String(m),completionMessage:String(f),h5pPath:String(p),workbookName:String(W),messageNpc:String(g),moduleMax:String(A),moduleName:String(y)})}}return console.log("Found workbook areas:",n),n}catch(s){return console.error("Error while getting workbook areas:",s),[]}}(async()=>{const d=await q();for(const e of d){let t;WA.room.area.onEnter(e.name).subscribe({next:()=>{t=WA.ui.displayActionMessage({message:"Drücke LEERTASTE zum Öffnen des Workbooks",callback:()=>{WA.ui.modal.openModal({title:e.moduleName,src:e.h5pPath,allowApi:!0,position:"left",allow:null})}})}}),WA.room.area.onLeave(e.moduleName).subscribe(()=>{t&&(t.remove(),WA.chat.close())})}const u=[{moduleKey:"module_3_1",triggerValue:"3",startX:4,endX:15,startY:71,endY:89},{moduleKey:"module_3_2",triggerValue:"4",startX:4,endX:15,startY:47,endY:85}];function l(e){const{moduleKey:t,triggerValue:a,startX:s,endX:n,startY:i,endY:r}=e;if(WA.player.state[t]!==a)return;const m=[],f=[];for(let p=s;p<=n;p++)for(let g=i;g<=r;g++)m.push({x:p,y:g,tile:"green",layer:"green"}),f.push({x:p,y:g,tile:null,layer:"red"});WA.room.setTiles(m),WA.room.setTiles(f)}WA.onInit().then(()=>{WA.player.state.module_1_1={},u.forEach(e=>l(e))}),u.forEach(e=>{WA.player.state.onVariableChange(e.moduleKey).subscribe(t=>{t===e.triggerValue&&l(e)})});const c=["Textarten","allgemeineRegeln","Sprache","Zitiren","ZitierenImText","Literaturverzeichnis","Literaturverwaltung"];for(const e of c)WA.player.state.onVariableChange(e).subscribe(t=>{x("modul_3",10),console.log(`Variable "${e}" changed to:`,t,"Level up, +10XP")})})();
//# sourceMappingURL=module3-main-671526c8.js.map
